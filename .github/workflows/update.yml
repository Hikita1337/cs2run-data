name: Update CS2Run History

on:
  workflow_dispatch:
  repository_dispatch:
    types: [external_update_trigger]
  # schedule:   # üîπ –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –∑–∞–ø—É—Å–∫ ‚Äî —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π
  #   - cron: "0 * * * *"  # —Ä–∞–∑ –≤ —á–∞—Å –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π

jobs:
  update-data:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm install axios

      - name: Fetch new CS2Run data
        run: node .github/scripts/update-data.js

      - name: Commit & Push if data changed
        run: |
          git config user.name "GitHub Action"
          git config user.email "actions@github.com"

          # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          if git diff --quiet; then
            echo "üü¢ –ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–º–∏—Ç."
          else
            echo "üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Äî —Å–æ—Ö—Ä–∞–Ω—è–µ–º!"
            git add data/cs2run_history.json
            git commit -m "üîÅ Update CS2Run history ($(date '+%Y-%m-%d %H:%M:%S'))"
            git push
          fi
